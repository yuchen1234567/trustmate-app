<%- include('partials/navbar') %>

<div class="container">
    <div class="page-header">
        <h1>My Support Tickets</h1>
        <a href="/support/tickets/create" class="btn btn-primary">Create New Ticket</a>
    </div>

    <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-error"><%= error %></div>
    <% } %>

    <% if (tickets.length === 0) { %>
        <div class="empty-state">
            <p>You haven't submitted any tickets yet</p>
            <a href="/support/tickets/create" class="btn btn-primary">Create Your First Ticket</a>
        </div>
    <% } else { %>
        <div class="tickets-grid">
            <% tickets.forEach(ticket => { %>
                <div class="ticket-card">
                    <div class="ticket-header">
                        <h3>#<%= ticket.ticket_id %> - <%= ticket.subject %></h3>
                        <span class="status-badge status-<%= ticket.status %>">
                            <%= ticket.status === 'pending' ? 'Pending' : 
                                ticket.status === 'in_progress' ? 'In Progress' : 
                                ticket.status === 'resolved' ? 'Resolved' : 'Closed' %>
                        </span>
                    </div>
                    
                    <div class="ticket-meta">
                        <span class="category-badge category-<%= ticket.category %>">
                            <%= ticket.category === 'order_issue' ? 'Order Issue' :
                                ticket.category === 'payment_issue' ? 'Payment Issue' :
                                ticket.category === 'service_inquiry' ? 'Service Inquiry' :
                                ticket.category === 'technical_support' ? 'Technical Support' :
                                ticket.category === 'complaint' ? 'Complaint' : 'Other' %>
                        </span>
                        <span class="priority-badge priority-<%= ticket.priority %>">
                            <%= ticket.priority === 'urgent' ? 'ðŸ”´ Urgent' :
                                ticket.priority === 'high' ? 'ðŸŸ  High' :
                                ticket.priority === 'medium' ? 'ðŸŸ¡ Medium' : 'ðŸŸ¢ Low' %>
                        </span>
                    </div>
                    
                    <div class="ticket-info">
                        <p><strong>Created:</strong> <%= new Date(ticket.created_at).toLocaleString('en-US') %></p>
                        <% if (ticket.assigned_name) { %>
                            <p><strong>Agent:</strong> <%= ticket.assigned_name %></p>
                        <% } else { %>
                            <p><strong>Agent:</strong> Unassigned</p>
                        <% } %>
                        <p><strong>Messages:</strong> <%= ticket.message_count %></p>
                    </div>
                    
                    <div class="ticket-actions">
                        <a href="/support/tickets/<%= ticket.ticket_id %>" class="btn btn-view">View Details</a>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } %>
</div>

<style>
.tickets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.ticket-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 15px;
}

.ticket-header h3 {
    margin: 0;
    font-size: 16px;
    flex: 1;
}

.ticket-meta {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.category-badge, .priority-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.category-badge {
    background: #e3f2fd;
    color: #1976d2;
}

.priority-urgent { background: #ffebee; color: #c62828; }
.priority-high { background: #fff3e0; color: #e65100; }
.priority-medium { background: #fff9c4; color: #f57f17; }
.priority-low { background: #e8f5e9; color: #2e7d32; }

.ticket-info {
    margin: 15px 0;
    font-size: 14px;
    color: #666;
}

.ticket-info p {
    margin: 5px 0;
}

.ticket-actions {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: #f5f5f5;
    border-radius: 8px;
}
</style>

<%- include('partials/footer') %>
