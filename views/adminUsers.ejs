<%- include('partials/adminNavbar') %>

<div class="admin-dashboard">
    <div class="page-header">
        <div class="page-header-content">
            <div class="page-breadcrumb">
                <a href="/admin/dashboard">ğŸ“Š Admin</a>
                <span class="breadcrumb-separator">â€º</span>
                <span class="breadcrumb-current">User Management</span>
            </div>
            <h1 class="page-title">
                <span class="page-icon">ğŸ‘¥</span>
                Admin Dashboard
            </h1>
        </div>
    </div>
    
    <div class="dashboard-nav">
        <a href="/admin/dashboard" class="nav-tab">
            <span class="tab-icon">ğŸ›¡ï¸</span>
            <span class="tab-label">Fraud Detection</span>
        </a>
        <a href="/admin/users" class="nav-tab active">
            <span class="tab-icon">ğŸ‘¥</span>
            <span class="tab-label">User Management</span>
        </a>
        <a href="/admin/orders" class="nav-tab">
            <span class="tab-icon">ğŸ“¦</span>
            <span class="tab-label">Order Management</span>
        </a>
        <a href="/admin/categories" class="nav-tab">
            <span class="tab-icon">ğŸ·ï¸</span>
            <span class="tab-label">Categories</span>
        </a>
    </div>
    
    <div class="user-management">
        <div class="section-header">
            <h2 class="section-title">
                <span class="section-icon">ğŸ‘¤</span>
                User Account Management
            </h2>
            <div class="section-meta">
                <span class="order-count"><%= users.length %> <%= users.length === 1 ? 'user' : 'users' %></span>
            </div>
        </div>
        
        <div class="search-container">
            <form action="/admin/users/search" method="GET" class="search-form-enhanced">
                <div class="search-input-wrapper">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" name="search" placeholder="Search by user ID, email, or username..." value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>">
                </div>
                <button type="submit" class="btn-search">Search</button>
            </form>
        </div>
        
        <div class="table-wrapper">
            <table class="users-table admin-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Email</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% const displayUsers = searchResults || users; %>
                    <% if (displayUsers.length === 0) { %>
                        <tr>
                            <td colspan="6">
                                <div class="empty-state-inline">
                                    <span class="empty-icon-small">ğŸ”</span>
                                    <span>No users found</span>
                                </div>
                            </td>
                        </tr>
                    <% } else { %>
                        <% displayUsers.forEach(user => { %>
                            <tr>
                                <td>
                                    <span class="user-id-badge">
                                        <span class="id-icon">ğŸ‘¤</span>
                                        #<%= String(user.user_id).padStart(3, '0') %>
                                    </span>
                                </td>
                                <td>
                                    <div class="email-cell">
                                        <span class="email-icon">ğŸ“§</span>
                                        <%= user.email %>
                                    </div>
                                </td>
                                <td>
                                    <span class="username-text"><%= user.username %></span>
                                </td>
                                <td>
                                    <span class="role-badge role-<%= user.role %>">
                                        <% if (user.role === 'admin') { %>ğŸ‘‘<% } else if (user.role === 'seller') { %>ğŸª<% } else { %>ğŸ‘¤<% } %>
                                        <%= user.role.toUpperCase() %>
                                    </span>
                                </td>
                                <td>
                                    <span class="status-badge status-<%= user.status %>">
                                        <% if (user.status === 'active') { %>âœ…<% } else { %>â„ï¸<% } %>
                                        <%= user.status %>
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="/admin/users/history/<%= user.user_id %>" class="btn-action btn-info" title="View History">
                                            <span>ğŸ“œ</span>
                                        </a>
                                        
                                        <% if (user.status === 'active') { %>
                                            <a href="/admin/users/freeze/<%= user.user_id %>" class="btn-action btn-freeze" title="Freeze Account" onclick="return confirm('Are you sure you want to freeze this account?')">
                                                <span>â„ï¸</span>
                                            </a>
                                        <% } else { %>
                                            <a href="/admin/users/unfreeze/<%= user.user_id %>" class="btn-action btn-unfreeze" title="Unfreeze Account">
                                                <span>âœ…</span>
                                            </a>
                                        <% } %>
                                        
                                        <a href="/admin/users/reset-password/<%= user.user_id %>" class="btn-action btn-reset" title="Reset Password" onclick="return confirm('Reset password to default?')">
                                            <span>ğŸ”‘</span>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<%- include('partials/footer') %>
