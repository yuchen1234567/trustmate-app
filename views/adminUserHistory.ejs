<%- include('partials/adminNavbar') %>

<div class="admin-dashboard">
    <div class="page-header">
        <div class="page-header-content">
            <div class="page-breadcrumb">
                <a href="/admin/dashboard">ğŸ“Š Admin</a>
                <span class="breadcrumb-separator">â€º</span>
                <a href="/admin/users">ğŸ‘¥ Users</a>
                <span class="breadcrumb-separator">â€º</span>
                <span class="breadcrumb-current">User History</span>
            </div>
            <h1 class="page-title">
                <span class="page-icon">ğŸ“œ</span>
                User History
            </h1>
        </div>
    </div>
    
    <div class="user-profile-card">
        <div class="profile-header">
            <div class="profile-avatar">
                <%= user.username.substring(0, 2).toUpperCase() %>
            </div>
            <div class="profile-info">
                <h2 class="profile-name"><%= user.username %></h2>
                <p class="profile-email">ğŸ“§ <%= user.email %></p>
            </div>
            <div class="profile-badge">
                <span class="role-badge role-<%= user.role %>">
                    <% if (user.role === 'admin') { %>ğŸ‘‘<% } else if (user.role === 'seller') { %>ğŸª<% } else { %>ğŸ‘¤<% } %>
                    <%= user.role.toUpperCase() %>
                </span>
            </div>
        </div>
        
        <div class="profile-details">
            <div class="detail-item">
                <span class="detail-icon">ğŸ“…</span>
                <div class="detail-content">
                    <span class="detail-label">Joined</span>
                    <span class="detail-value"><%= new Date(user.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></span>
                </div>
            </div>
            
            <div class="detail-item">
                <span class="detail-icon">
                    <% if (user.status === 'active') { %>âœ…<% } else { %>â„ï¸<% } %>
                </span>
                <div class="detail-content">
                    <span class="detail-label">Status</span>
                    <span class="detail-value">
                        <span class="status-badge status-<%= user.status %>"><%= user.status %></span>
                    </span>
                </div>
            </div>
            
            <div class="detail-item">
                <span class="detail-icon">ğŸ›’</span>
                <div class="detail-content">
                    <span class="detail-label">Total Orders</span>
                    <span class="detail-value"><%= orders.length %></span>
                </div>
            </div>
            
            <div class="detail-item">
                <span class="detail-icon">ğŸ’°</span>
                <div class="detail-content">
                    <span class="detail-label">Total Spent</span>
                    <span class="detail-value">$<%= orders.reduce((sum, order) => sum + parseFloat(order.total_amount || 0), 0).toFixed(2) %></span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="section-header">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“¦</span>
            Order History
        </h2>
        <div class="section-meta">
            <span class="order-count"><%= orders.length %> <%= orders.length === 1 ? 'order' : 'orders' %></span>
        </div>
    </div>
    
    <% if (orders.length === 0) { %>
        <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <h3>No Orders Yet</h3>
            <p>This user hasn't placed any orders.</p>
        </div>
    <% } else { %>
        <div class="orders-table-container">
            <table class="admin-table orders-history-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Date</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% orders.forEach(order => { %>
                        <tr>
                            <td>
                                <span class="order-id-badge">#<%= order.order_id %></span>
                            </td>
                            <td>
                                <div class="date-cell">
                                    <span class="date-primary"><%= new Date(order.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></span>
                                    <span class="date-secondary"><%= new Date(order.created_at).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %></span>
                                </div>
                            </td>
                            <td>
                                <span class="items-count">
                                    <%= order.item_count || 1 %> <%= (order.item_count || 1) === 1 ? 'item' : 'items' %>
                                </span>
                            </td>
                            <td>
                                <span class="amount-value">$<%= typeof order.total_amount === 'number' ? order.total_amount.toFixed(2) : parseFloat(order.total_amount || 0).toFixed(2) %></span>
                            </td>
                            <td>
                                <span class="status-badge status-<%= order.status %>"><%= order.status %></span>
                            </td>
                            <td>
                                <a href="/orders/<%= order.order_id %>" class="btn-small btn-view-order">
                                    <span>ğŸ‘ï¸</span> View
                                </a>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    <% } %>
    
    <div class="page-actions">
        <a href="/admin/users" class="btn-back">
            <span>â†</span> Back to Users
        </a>
    </div>
</div>

<%- include('partials/footer') %>
